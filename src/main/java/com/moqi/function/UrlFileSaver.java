package com.moqi.function;


import com.alibaba.fastjson.JSONObject;
import com.moqi.bean.DoubanMusican;

import java.io.BufferedInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.List;
import java.util.Random;

/**
 * Java 利用 URL 下载 MP3 保存到本地
 * http://blog.sina.com.cn/s/blog_4e00ee550100b02j.html
 *
 * @author wenbo17
 * On 9/7/19 10:45
 */
public class UrlFileSaver implements Runnable {

    private static final int BUFFER_SIZE = 4096;
    private static final String LOCAL_PREFIX = "/Users/moqi/Music/DoubanMusician/";
    private static final Random RANDOM = new Random();
    private static final String MP3 = ".mp3";
    private String destUrl;
    private String fileName;

    public static void main(String[] args) {
        // testDownload();
        testDownloadMore();
    }

    private static void testDownloadMore() {
        String json = "{\"playlist\": [{\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"8:07\", \"lyrics\": \"\", \"title\": \"\\u3010\\u7f8e\\u6587\\u3011\\u300a\\u4e00\\u5929\\u957f\\u4e00\\u70b9\\u300b-\\u5218\\u745c-\\u897f\\u74dc\\u599e\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=614196\", \"is_downloadable\": false, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"5644\", \"url\": \"http://mm1.doubanio.com/201909081904/af181ad43564d6fb1c0f0e6ac6216ae8/view/musicianmp3/mp3/x17693518.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"614196\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"16:22\", \"lyrics\": \"\", \"title\": \"\\u3010\\u7f8e\\u6587\\u3011\\u300a\\u8fd9\\u4e2a\\u5584\\u53d8\\u7684\\u4e16\\u754c\\u96be\\u5f97\\u6709\\u4f60\\u300b-\\u5c0f\\u5317-\\u9ec4\\u5c0f\\u5e0c\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=579915\", \"is_downloadable\": false, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"8057\", \"url\": \"http://mm1.doubanio.com/201909081904/01f8ff23e272267cce9a86948dcaeae8/view/musicianmp3/mp3/x17253140.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"579915\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"9:40\", \"lyrics\": \"\", \"title\": \"\\u3010\\u60c5\\u4eba\\u8282\\u3011\\u300a\\u8fd9\\u5c31\\u662f\\u7231\\u60c5\\u300b-\\u9152\\u9152\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=565201\", \"is_downloadable\": false, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"5057\", \"url\": \"http://mm1.doubanio.com/201909081904/8561447bcb7ec8ecf8a9c0ad9a8b794b/view/musicianmp3/mp3/x17067120.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"565201\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"26:06\", \"lyrics\": \"\", \"title\": \"\\u3010\\u65f6\\u6587\\u3011\\u300a\\u5e74\\u8f7b\\u4eba\\u4e0d\\u662f\\u8584\\u60c5\\u5be1\\u4e49\\uff0c\\u8fd9\\u662f\\u5bf9\\u4e16\\u754c\\u7684\\u53e6\\u4e00\\u79cd\\u627f\\u62c5\\u300b-\\u9648\\u8d6b-Lucius\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=560524\", \"is_downloadable\": true, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"5057\", \"url\": \"http://mm1.doubanio.com/201909081904/ee68abc7a70e6101db02a63b3ab6ad47/view/musicianmp3/mp3/x17004414.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"560524\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"6:34\", \"lyrics\": \"\", \"title\": \"\\u3010\\u73b0\\u4ee3\\u8bd7\\u3011\\u300a\\u4f59\\u79c0\\u534e\\u8bd7\\u4e09\\u9996\\u300b-\\u4f59\\u79c0\\u534e-\\u963f\\u8bd7\\u4e3d\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=559115\", \"is_downloadable\": true, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"2834\", \"url\": \"http://mm1.doubanio.com/201909081904/e4f153ddecf663bbfd3980d86ba6bd30/view/musicianmp3/mp3/x16985643.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"559115\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"8:26\", \"lyrics\": \"\", \"title\": \"\\u3010\\u7f8e\\u6587\\u3011\\u300a\\u8fd9\\u65f6\\u5019\\u4f60\\u624d\\u7b97\\u957f\\u5927\\u300b-\\u5f20\\u6d01-\\u590f\\u5c0f\\u6696\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=557568\", \"is_downloadable\": true, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"3865\", \"url\": \"http://mm1.doubanio.com/201909081904/fa842bdc080576cf7e113ad917763705/view/musicianmp3/mp3/x16964504.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"557568\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"6:48\", \"lyrics\": \"\", \"title\": \"\\u3010\\u7f8e\\u6587\\u3011\\u300a\\u8fd9\\u4e00\\u5207\\u90fd\\u662f\\u6700\\u597d\\u7684\\u5b89\\u6392\\u300b-\\u8f89\\u59d1\\u5a18\\u7684\\u590f\\u5929-\\u9648\\u5e74\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=562721\", \"is_downloadable\": true, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"3640\", \"url\": \"http://mm1.doubanio.com/201909081904/91546cff01403d8409eaf9d31323cca8/view/musicianmp3/mp3/x17034718.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"562721\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"14:15\", \"lyrics\": \"\", \"title\": \"\\u3010\\u7f8e\\u6587\\u3011\\u300a\\u548c\\u4f60\\u4e00\\u8d77\\u7f8e\\u597d\\u4e0b\\u53bb\\u5427\\u300b-\\u5927\\u5723-\\u590f\\u5c0f\\u6696\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=556372\", \"is_downloadable\": true, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"2865\", \"url\": \"http://mm1.doubanio.com/201909081904/fb333ca530bac549c05636a16ff37500/view/musicianmp3/mp3/x16946557.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"556372\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"12:02\", \"lyrics\": \"\", \"title\": \"\\u3010\\u7f8e\\u6587\\u3011\\u300a\\u6bd4\\u5982\\u6211\\u60f3\\u4f60\\u7684\\u65b9\\u5f0f\\u300b-\\u9955\\u4e4b\\u9065\\u9065-\\u590f\\u5c0f\\u6696\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=555854\", \"is_downloadable\": true, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"2828\", \"url\": \"http://mm1.doubanio.com/201909081904/4e6ca16db5bf5f0d4e5297bf147d6b17/view/musicianmp3/mp3/x16939643.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"555854\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"11:23\", \"lyrics\": \"\", \"title\": \"\\u3010\\u539f\\u521b\\u3011\\u300a\\u4f60\\u5728\\u4e3a\\u8c01\\u5de5\\u4f5c\\uff1f\\u300b-\\u5434\\u94ed-\\u5434\\u94ed\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=509331\", \"is_downloadable\": true, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"7221\", \"url\": \"http://mm1.doubanio.com/201909081904/9332a5fb9ae6272a0b5c39965f9d90e9/view/musicianmp3/mp3/x16315506.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"509331\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"12:47\", \"lyrics\": \"\", \"title\": \"\\u3010\\u7f8e\\u6587\\u3011\\u300a\\u6d3b\\u523026\\u5c81\\uff0c\\u7136\\u540e\\u6b7b\\u53bb\\u300b-\\u96f7\\u6587\\u79d1-\\u8fc1\\u5ef6\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=514629\", \"is_downloadable\": true, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"9057\", \"url\": \"http://mm1.doubanio.com/201909081904/6a88547923ef9490ca95cecf8b3bf126/view/musicianmp3/mp3/x16390930.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"514629\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"15:11\", \"lyrics\": \"\", \"title\": \"\\u3010\\u7f8e\\u6587\\u3011\\u300a\\u4e8e\\u662f\\u4f60\\u5e7b\\u60f3\\u53bb\\u65c5\\u884c\\u300b-\\u6bd4\\u76ee\\u9c7c-\\u90a3\\u6749\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=512245\", \"is_downloadable\": true, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"24138\", \"url\": \"http://mm1.doubanio.com/201909081904/ec480848826a46e36909f051301dcc0b/view/musicianmp3/mp3/x16355570.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"512245\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"10:02\", \"lyrics\": \"\", \"title\": \"\\u3010\\u7f8e\\u6587\\u3011\\u300a\\u6700\\u597d\\u7684\\u65f6\\u5149\\u300b-\\u5218\\u745c-\\u9003\\u79bb\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=480671\", \"is_downloadable\": true, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"7721\", \"url\": \"http://mm1.doubanio.com/201909081904/63bcc8474fef76be52a81d1750f37fba/view/musicianmp3/mp3/x15957527.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"480671\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"16:07\", \"lyrics\": \"\", \"title\": \"\\u3010\\u7f8e\\u6587\\u3011\\u300a\\u6211\\u59cb\\u7ec8\\u76f8\\u4fe1\\u52aa\\u529b\\u594b\\u6597\\u7684\\u610f\\u4e49\\u300b-\\u963f\\u5446\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=479257\", \"is_downloadable\": true, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"11700\", \"url\": \"http://mm1.doubanio.com/201909081904/11dc212bbda269c066100d9103d0cf6c/view/musicianmp3/mp3/x15940061.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"479257\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"2:39\", \"lyrics\": \"\", \"title\": \"\\u3010\\u7f8e\\u6587\\u3011\\u300a\\u4e00\\u58f0\\u9e1f\\u6216\\u4e00\\u5835\\u5899\\u300b-\\u6797\\u6e05\\u7384-\\u9003\\u79bb\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=483795\", \"is_downloadable\": true, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"7227\", \"url\": \"http://mm1.doubanio.com/201909081904/f2e2287cbca9321965803300b3d54f1f/view/musicianmp3/mp3/x15996142.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"483795\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"6:40\", \"lyrics\": \"\", \"title\": \"\\u3010\\u7f8e\\u6587\\u3011\\u300a\\u6bd4\\u5229\\u65f6\\u300b-\\u6728\\u5915\\u4e91\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=473528\", \"is_downloadable\": true, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"3345\", \"url\": \"http://mm1.doubanio.com/201909081904/3f90202f5984ce0f509dc063e63a947d/view/musicianmp3/mp3/x15868379.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"473528\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"10:03\", \"lyrics\": \"\", \"title\": \"\\u3010\\u7f8e\\u6587\\u3011\\u300a\\u91cd\\u9022\\u300b-\\u5434\\u5ff5\\u771f-\\u8bfa\\u5317\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=475720\", \"is_downloadable\": true, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"6888\", \"url\": \"http://mm1.doubanio.com/201909081904/955945a9617ae02f88acaf697089cd37/view/musicianmp3/mp3/x15895609.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"475720\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"15:18\", \"lyrics\": \"\", \"title\": \"\\u3010\\u7f8e\\u6587\\u3011\\u300a\\u4f46\\u613f\\u4f60\\u6211\\uff0c\\u5e78\\u8fd0\\u5982\\u6b64\\u300b-\\u4e5d\\u4e5d-\\u6773\\u6773\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=471613\", \"is_downloadable\": true, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"8477\", \"url\": \"http://mm1.doubanio.com/201909081904/0c67fe2d5ee8c811fc1129e22646a273/view/musicianmp3/mp3/x15844635.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"471613\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"11:59\", \"lyrics\": \"\", \"title\": \"\\u3010\\u7f8e\\u6587\\u3011\\u300a\\u8bba\\u5bc2\\u5bde\\u300b-\\u6881\\u6653\\u58f0-\\u4e09\\u4e03\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=470275\", \"is_downloadable\": true, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"6032\", \"url\": \"http://mm1.doubanio.com/201909081904/ee2d0d1185618d29be3d5819e8117cf2/view/musicianmp3/mp3/x15828255.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"470275\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"15:55\", \"lyrics\": \"\", \"title\": \"\\u3010\\u7f8e\\u6587\\u3011\\u300a\\u591a\\u5c11\\u4eba\\u8d25\\u7ed9\\u4e86\\u4e00\\u4e2a\\u5b57\\u201c\\u7b49\\u201d\\u300b-\\u9ec4\\u5c0f\\u5e0c\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=472316\", \"is_downloadable\": true, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"10620\", \"url\": \"http://mm1.doubanio.com/201909081904/72c772108336774f2618340f719fc033/view/musicianmp3/mp3/x15853223.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"472316\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}, {\"styles\": [], \"picture\": [\"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\"], \"play_length\": \"6:29\", \"lyrics\": \"\", \"title\": \"\\u3010\\u8bd7\\u6b4c\\u3011\\u300a\\u4e00\\u89c1\\u949f\\u60c5\\u300b-\\u7ef4\\u65af\\u74e6\\u5a03\\u2022\\u8f9b\\u6ce2\\u4e1d\\u5361-\\u51ac\\u9752\\u4e3b\\u64ad\", \"is_commentable\": true, \"subject_id\": \"0\", \"rec_url\": \"https://site.douban.com/111828/?s=224854\", \"is_downloadable\": true, \"artist_name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"label\": \"\", \"play_count\": \"12808\", \"url\": \"http://mm1.doubanio.com/201909081904/25104be03ff757183cae4768238c4738/view/musicianmp3/mp3/x12880283.mp3\", \"is_selling\": false, \"publish_date\": \"\", \"sid\": \"224854\", \"is_collected\": false, \"artist\": {\"picture\": \"https://img3.doubanio.com/view/site/large/public/89c2c46f11363c5.jpg\", \"cover_color\": [\"#ffb0aa\", \"#332a29\", \"#ee5044\"], \"kind\": \"dj\", \"follower\": 201528, \"id\": \"111828\", \"is_royalty_artist\": false, \"style\": \"YueDu.FM\", \"name\": \"\\u503e\\u542c\\u6587\\u5b57\\u7684\\u58f0\\u97f3\", \"url\": \"https://site.douban.com/reading/\", \"song_count\": 386, \"genre_url\": \"https://music.douban.com/disc_jockeys/\"}}]}";

        DoubanMusican musican = JSONObject.parseObject(json, DoubanMusican.class);
        List<DoubanMusican.PlaylistBean> playlist = musican.getPlaylist();

        int count = 0;
        for (DoubanMusican.PlaylistBean playlistBean : playlist) {
            count++;

            String destUrl = playlistBean.getUrl();
            String fileName = playlistBean.getTitle();
            // parallelDownload(destUrl, fileName);
            serialDownload(destUrl, fileName);
        }
        System.out.println("共下载条目数： " + count);
    }

    /**
     * 串行下载
     */
    private static void serialDownload(String destUrl, String fileName) {
        download(destUrl, fileName + MP3);
    }

    /**
     * 并行下载
     */
    private static void parallelDownload(String destUrl, String fileName) {
        new Thread(new UrlFileSaver(destUrl, fileName)).start();
    }

    private static void testDownload() {
        String destUrl = "http://mm1.doubanio.com/201909071036/ebecff96975305362a90ee1ffb54347b/view/musicianmp3/mp3/x15379249.mp3";
        String fileName = "【美文】《我曾经爱过的》-天街雨主播";
        Thread th = new Thread(new UrlFileSaver(destUrl, fileName));
        th.start();
    }

    /**
     * 将网络文件保存为本地文件的方法
     */
    private static void saveToFile(String destUrl, String fileName) throws IOException {

         // 随机休息几秒，缓解网页 503
        try {
            Thread.sleep(RANDOM.nextInt(10));
        } catch (InterruptedException e) {
            // do nothing
        }

        FileOutputStream fos;
        BufferedInputStream bis;
        HttpURLConnection connection;
        URL url;
        byte[] buf = new byte[BUFFER_SIZE];
        int size;

        // 建立链接
        url = new URL(destUrl);
        connection = (HttpURLConnection) url.openConnection();
        connection.setRequestProperty("User-Agent", "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36");
        // 连接指定的资源
        connection.connect();
        // 获取网络输入流
        bis = new BufferedInputStream(connection.getInputStream());
        // 建立文件
        String fullFileName = LOCAL_PREFIX + fileName;
        fos = new FileOutputStream(fullFileName);

        System.out.println("正在获取链接 [" + destUrl + "] 的内容 \n 将其保存为文件 [" + fullFileName + "] ");

        // 保存文件
        while ((size = bis.read(buf)) != -1) {
            fos.write(buf, 0, size);
        }

        fos.close();
        bis.close();
        connection.disconnect();
    }

    private UrlFileSaver(String destUrl, String fileName) {
        this.destUrl = destUrl;
        this.fileName = fileName + MP3;
        // 取 / 最后名字的逻辑，这里用不上
        // int i = destUrl.lastIndexOf("/");
        // this.fileName = fileName + destUrl.substring(i + 1);
    }


    @Override
    public void run() {
        download(destUrl, fileName);
    }

    /**
     * 下载方法
     */
    private static void download(String destUrl, String fileName) {
        try {
            saveToFile(destUrl, fileName);
            System.out.println("文件：" + destUrl + " 下载完成 ");
        } catch (IOException e) {
            System.out.println("文件下载失败，信息：" + e.getMessage());
        }
    }

}